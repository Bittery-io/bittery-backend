version: "3"

networks:
  bittery-net:

services:

  lnd_bitcoin:
    image: bitteryio/lnd:${LND_HOSTED_VERSION}
    container_name: lnd_bitcoin
    restart: unless-stopped
    entrypoint: "lnd --bitcoin.active \
                     --bitcoin.mainnet \
                     --bitcoin.node=bitcoind \
                     --rpclisten=0.0.0.0:10009 \
                     --bitcoind.rpcuser=${BITCOIND_RPC_USER} \
                     --bitcoind.rpcpass=${BITCOIND_RPC_PASSWORD} \
                     --bitcoind.rpchost=${BITCOIND_RPC_HOST}:43783 \
                     --bitcoind.zmqpubrawblock=tcp://${BITCOIND_RPC_HOST}:28334 \
                     --bitcoind.zmqpubrawtx=tcp://${BITCOIND_RPC_HOST}:28335 \
                     --alias=${LN_ALIAS} \
                     --alias=${LN_ALIAS} \
                     $WUMBO_CHANNELS
                     --tlsextraip=${LND_IP} \
                     --restlisten=0.0.0.0:8080"
    volumes:
      - ./volumes/lnd:/root/.lnd
    networks:
      - bittery-net
    expose:
      - 8080
      - 10009
    ports:
      - 9735:9735

  rtl:
    image: bitteryio/rtl:${RTL_HOSTED_VERSION}
    container_name: rtl
    environment:
      - RTL_CONFIG_PATH=/config
    volumes:
      - ./volumes/lnd/data/chain/bitcoin/mainnet:/data/macaroon:ro
      - ./volumes/rtl/channel_backup:/data/channel_backup
      - ./volumes/rtl/config:/config
    networks:
      - bittery-net
    expose:
      - 3000

  nginx:
    restart: unless-stopped
    image: nginx:1.19.4
    container_name: nginx
    volumes:
      - ./volumes/nginx/conf:/etc/nginx/conf.d:rw
      - ./volumes/nginx/vhost:/etc/nginx/vhost.d
      - ./volumes/nginx/html:/usr/share/nginx/html
      - ./volumes/nginx/certs:/etc/nginx/certs:ro
      - ./volumes/lnd/:/etc/nginx/lnd
    networks:
      - bittery-net
    ports:
      - 443:443
      - 10009:10009
